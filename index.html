<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KDLI AI Evaluation v7.2</title>
    <style>
        :root { --primary-color: #059669; --bg-color: #f0fdf4; --card-bg: #ffffff; --accent-color: #10b981; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); margin: 0; padding: 10px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { width: 100%; max-width: 600px; background: var(--card-bg); padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); box-sizing: border-box; }
        .page { display: none; text-align: center; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        
        .logo-wrapper { margin-bottom: 20px; }
        .logo-img { max-width: 180px; height: auto; border-radius: 12px; }
        
        .btn { width: 100%; background: var(--primary-color); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 17px; font-weight: bold; cursor: pointer; margin: 8px 0; }
        input { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 16px; text-align: center; box-sizing: border-box; margin-bottom: 12px; outline:none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .card { padding: 15px; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; background: white; transition: 0.2s; font-weight: bold; }
        .card.selected { border-color: var(--primary-color); background: #f0fdf4; }
        .question-box { background: #f8fafc; padding: 18px; border-radius: 15px; border-left: 5px solid var(--primary-color); text-align: left; margin-bottom: 15px; }
        .guide-box { background: #ffffff; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 10px; text-align: left; font-size: 0.9rem; line-height: 1.6; }
        .guide-label { display: inline-block; padding: 2px 8px; background: var(--primary-color); color: white; border-radius: 5px; font-size: 0.75rem; font-weight: bold; margin-bottom: 8px; }
        .timer-clock { font-size: 40px; font-weight: 800; margin: 10px 0; color: #1e293b; }
        .status-bar { width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
        .progress { height: 100%; background: var(--primary-color); width: 0%; transition: width 1s linear; }
        .option-btn { width: 100%; text-align: left; background: white; border: 1px solid #cbd5e1; padding: 12px; border-radius: 10px; margin-bottom: 8px; font-size: 14px; cursor: pointer; }
        .option-btn.selected { border-color: var(--primary-color); background: #f0fdf4; font-weight: bold; }
        .report-card { text-align: left; background: #f8fafc; padding: 18px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .report-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary-color); padding-bottom: 8px; margin-bottom: 10px; }
        .loading { color: var(--primary-color); font-weight: bold; margin-top: 15px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="page-id" class="page active">
        <div class="logo-wrapper">
            <img id="main-logo" src="https://drive.google.com/uc?export=view&id=ë³¸ì¸ì˜_íŒŒì¼_ID" alt="Logo" class="logo-img">
        </div>
        <h2 style="color:var(--primary-color); margin-top:0;">AI Multi-Lang Test</h2>
        <input type="text" id="examinee-id" placeholder="Examinee ID (ìˆ˜í—˜ë²ˆí˜¸)">
        <input type="password" id="api-key-input" placeholder="Gemini API Key">
        <button class="btn" onclick="validateStep1()">Next / ë‹¤ìŒ</button>
    </div>

    <div id="page-test-lang" class="page">
        <h3>í‰ê°€ ì–¸ì–´ ì„ íƒ<br><small style="color:#64748b; font-size:0.9rem;">Choose Test Language</small></h3>
        <div class="grid">
            <div class="card" onclick="selectTestLang('ko')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</div>
            <div class="card" onclick="selectTestLang('en')">ğŸ‡ºğŸ‡¸ English</div>
            <div class="card" onclick="selectTestLang('zh')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</div>
        </div>
        <button class="btn" id="lang-next-btn" style="display:none;" onclick="handleLangNext()">Next / ë‹¤ìŒ</button>
    </div>

    <div id="page-guide-lang" class="page">
        <h3>ë³´ì¡° ì•ˆë‚´ ì–¸ì–´ ì„ íƒ<br><small style="color:#64748b; font-size:0.9rem;">Choose Support Language</small></h3>
        <div class="grid">
            <div class="card" onclick="selectGuideLang('English')">ğŸ‡ºğŸ‡¸ English</div>
            <div class="card" onclick="selectGuideLang('Arabic')">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
            <div class="card" onclick="selectGuideLang('Russian')">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</div>
            <div class="card" onclick="selectGuideLang('Vietnamese')">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</div>
        </div>
        <button class="btn" id="guide-next-btn" style="display:none;" onclick="showInstructions()">Confirm / í™•ì¸</button>
    </div>

    <div id="page-instructions" class="page">
        <h3>ì‹œí—˜ ìœ ì˜ì‚¬í•­ (Instructions)</h3>
        <div class="guide-box" style="border-left: 5px solid var(--primary-color);">
            <span class="guide-label">ğŸ‡°ğŸ‡· í•œêµ­ì–´</span><br>
            <div id="ko-inst-text">1, 2ë²ˆì€ ì§€ë¬¸ ë‚­ë… ë° ì‚¬ì§„ ë¬˜ì‚¬ ë¬¸ì œì…ë‹ˆë‹¤. 3ë²ˆì€ ëŒ€í™”ë¥¼ ë“£ê³  ì •ë‹µì„ ê³ ë¥´ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</div>
        </div>
        <div id="support-guide-area" class="guide-box" style="border-left: 5px solid #64748b;">
            <span class="guide-label" id="support-lang-label">Support Language</span><br>
            <div id="support-inst-text"></div>
        </div>
        <button class="btn" onclick="startQuestion(1)">ì‹œí—˜ ì‹œì‘ (Start Test)</button>
    </div>

    <div id="page-exam" class="page">
        <div style="display:flex; justify-content: space-between; font-size: 13px; margin-bottom:10px;">
            <span id="q-title" style="font-weight:bold; color:var(--primary-color)"></span>
            <span id="display-id"></span>
        </div>
        <div id="image-area" style="display:none; margin-bottom:10px;"><img id="question-image" src="" style="width:100%; border-radius:10px; max-height:140px; object-fit:contain;"></div>
        <div class="question-box">
            <p id="q-instruction" style="font-weight:bold; color:var(--primary-color); margin-top:0;"></p>
            <p id="target-text" style="font-size: 1.1rem;"></p>
            <div id="option-area" class="option-container" style="display:none;">
                <div class="option-btn" onclick="selectOption(0)">1. <span id="opt0"></span></div>
                <div class="option-btn" onclick="selectOption(1)">2. <span id="opt1"></span></div>
                <div class="option-btn" onclick="selectOption(2)">3. <span id="opt2"></span></div>
                <div class="option-btn" onclick="selectOption(3)">4. <span id="opt3"></span></div>
            </div>
        </div>
        <div id="recording-msg" style="display:none; color:#ef4444; font-weight:bold; margin-bottom:10px;">â— Recording (ë…¹ìŒ ì¤‘)...</div>
        <div id="timer-label" style="font-size:13px; color:#64748b;">Waiting</div>
        <div class="timer-clock" id="timer-display">00:00</div>
        <div class="status-bar"><div class="progress" id="progress-bar"></div></div>
        <div id="loading-msg" class="loading">â³ Analyzing / ë¶„ì„ ì¤‘...</div>
    </div>

    <div id="page-summary" class="page">
        <h2 id="report-title">Score Report</h2>
        <div id="report-container"></div>
        <div style="background:var(--primary-color); color:white; padding:15px; border-radius:15px; margin:15px 0;">
            <h3 style="margin:0;">Average: <span id="final-avg">0</span></h3>
        </div>
        <button class="btn" onclick="location.reload()" style="background:#64748b;">Restart / ì´ˆê¸°í™”</button>
    </div>
</div>

<script>
    let USER_API_KEY = "", examineeID = "", testLang = "", guideLang = "English", currentQuestion = 1;
    let results = { 1: {score:0, fb:""}, 2: {score:0, fb:""}, 3: {score:0, fb:""} };
    let selectedIdx = -1;
    
    // [ëª¨ë°”ì¼ ëŒ€ì‘] ì „ì—­ ì˜¤ë””ì˜¤ ê°ì²´ í•˜ë‚˜ë¥¼ ì¬ì‚¬ìš©í•¨
    let ttsAudio = new Audio();

    const supportGuides = {
        "English": "Questions 1-2: Read aloud and describe the photo. Question 3: Listening comprehension. Please follow the signal.",
        "Arabic": "Ø³ 1-2: Ø§Ù‚Ø±Ø£ Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©. Ø³ 3: ÙÙ‡Ù… Ù…Ø³Ù…ÙˆØ¹. ÙŠØ±Ø¬Ù‰ Ø§ØªØ¨Ø§Ø¹ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©.",
        "Russian": "Q1-Q2: Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ğ²ÑĞ»ÑƒÑ… Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ„Ğ¾Ñ‚Ğ¾. Q3: ĞÑƒĞ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑĞ»ĞµĞ´ÑƒĞ¹Ñ‚Ğµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñƒ.",
        "Vietnamese": "CÃ¢u 1-2: Äá»c to vÃ  mÃ´ táº£ áº£nh. CÃ¢u 3: Nghe hiá»ƒu. Vui lÃ²ng lÃ m theo tÃ­n hiá»‡u."
    };

    const testData = {
        'ko': {
            teacher: "í•œêµ­ì–´ ì„ ìƒë‹˜",
            questions: {
                1: { title: "ë¬¸í•­ 1", instruction: "ì§€ë¬¸ì„ ì†Œë¦¬ ë‚´ì–´ ì½ìœ¼ì„¸ìš”.", text: "êµ­ë°©ì–´í•™ì›ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.", type: "speak", prep: 5, resp: 10 },
                2: { title: "ë¬¸í•­ 2", instruction: "ì‚¬ì§„ì„ ë³´ê³  ìƒí™©ì„ ë¬˜ì‚¬í•˜ì„¸ìš”.", text: "(ì‚¬ì§„ì˜ ì¥ì†Œì™€ ë™ì‘ì„ ì„¤ëª…í•˜ì„¸ìš”)", image: "https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=400", type: "speak", prep: 5, resp: 15 },
                3: { title: "ë¬¸í•­ 3", instruction: "ëŒ€í™”ë¥¼ ë“£ê³  ì•Œë§ì€ ë‹µì„ ê³ ë¥´ì„¸ìš”.", audioText: "ì–´ë””ì— ê°€ì‹­ë‹ˆê¹Œ?", options: ["í•™êµì— ê°‘ë‹ˆë‹¤.", "ì–´ì œ ê°”ìŠµë‹ˆë‹¤.", "ì¹œêµ¬ê°€ ì˜µë‹ˆë‹¤.", "ë‚ ì”¨ê°€ ì¢‹ìŠµë‹ˆë‹¤."], answer: 0, type: "choose", resp: 12 }
            }
        },
        'en': {
            teacher: "English Teacher",
            questions: {
                1: { title: "Question 1", instruction: "Read the text aloud.", text: "Welcome to the international military school.", type: "speak", prep: 5, resp: 10 },
                2: { title: "Question 2", instruction: "Describe the photo.", text: "(Explain what is happening in the picture)", image: "https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=400", type: "speak", prep: 5, resp: 15 },
                3: { title: "Question 3", instruction: "Listen and choose the best response.", audioText: "How's the weather today?", options: ["It's sunny.", "I like pizza.", "At the library.", "Fine, thank you."], answer: 0, type: "choose", resp: 12 }
            }
        },
        'zh': {
            teacher: "ä¸­æ–‡è€å¸ˆ",
            questions: {
                1: { title: "ç¬¬ä¸€é¢˜", instruction: "è¯·æœ—è¯»ä¸‹é¢çš„å¥å­ã€‚", text: "æ¬¢è¿æ¥åˆ°å›½é˜²è¯­è¨€å­¦é™¢ã€‚", type: "speak", prep: 5, resp: 10 },
                2: { title: "ç¬¬äºŒé¢˜", instruction: "è¯·æè¿°è¿™å¼ å›¾ç‰‡ã€‚", text: "(è¯·è¯¦ç»†æè¿°å›¾ç‰‡ä¸­çš„åœºæ™¯)", image: "https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=400", type: "speak", prep: 5, resp: 15 },
                3: { title: "ç¬¬ä¸‰é¢˜", instruction: "å¬å¯¹è¯ï¼Œé€‰æ‹©æ­£ç¡®çš„ç­”æ¡ˆã€‚", audioText: "ä½ åƒé¥­äº†å—ï¼Ÿ", options: ["æˆ‘åƒäº†ã€‚", "ä»–æ˜¯è€å¸ˆã€‚", "å¾ˆå¥½çœ‹ã€‚", "å»å•†åº—ã€‚"], answer: 0, type: "choose", resp: 12 }
            }
        }
    };

    function validateStep1() {
        examineeID = document.getElementById('examinee-id').value.trim();
        USER_API_KEY = document.getElementById('api-key-input').value.trim();
        if(!examineeID || !USER_API_KEY) return alert("ìˆ˜í—˜ë²ˆí˜¸ì™€ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        
        // [ëª¨ë°”ì¼ ëŒ€ì‘] ì‚¬ìš©ì í´ë¦­ ì‹œ ì˜¤ë””ì˜¤ ì—”ì§„ Unlock
        ttsAudio.play().then(() => {
            ttsAudio.pause();
            ttsAudio.currentTime = 0;
        }).catch(() => {});

        goToPage('page-test-lang');
    }

    // selectTestLang, handleLangNext, selectGuideLang, showInstructions ë“± ë™ì¼...
    function selectTestLang(lang) {
        testLang = lang;
        document.querySelectorAll('#page-test-lang .card').forEach(c => c.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        document.getElementById('lang-next-btn').style.display = 'block';
    }
    function handleLangNext() {
        if(testLang === 'ko') goToPage('page-guide-lang');
        else showInstructions();
    }
    function selectGuideLang(lang) {
        guideLang = lang;
        document.querySelectorAll('#page-guide-lang .card').forEach(c => c.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        document.getElementById('guide-next-btn').style.display = 'block';
    }
    function showInstructions() {
        if(testLang === 'ko') {
            document.getElementById('support-guide-area').style.display = 'block';
            document.getElementById('support-lang-label').innerText = guideLang;
            document.getElementById('support-inst-text').innerText = supportGuides[guideLang];
        } else {
            document.getElementById('support-guide-area').style.display = 'none';
        }
        goToPage('page-instructions');
    }

    function startQuestion(num) {
        currentQuestion = num; selectedIdx = -1;
        const q = testData[testLang].questions[num];
        document.getElementById('display-id').innerText = `ID: ${examineeID}`;
        document.getElementById('q-title').innerText = q.title;
        document.getElementById('q-instruction').innerText = q.instruction;
        document.getElementById('target-text').innerText = (q.type === 'speak') ? q.text : "";
        document.getElementById('image-area').style.display = q.image ? 'block' : 'none';
        if(q.image) document.getElementById('question-image').src = q.image;
        
        const optArea = document.getElementById('option-area');
        if(q.type === 'choose') {
            optArea.style.display = 'block';
            q.options.forEach((opt, i) => {
                const btn = document.getElementById(`opt${i}`).parentNode;
                btn.classList.remove('selected');
                document.getElementById(`opt${i}`).innerText = opt;
            });
        } else { optArea.style.display = 'none'; }

        goToPage('page-exam');
        runProcess(q);
    }

    async function runProcess(q) {
        if (q.type === 'speak') {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const mediaRecorder = new MediaRecorder(stream);
            let chunks = [];
            mediaRecorder.ondataavailable = e => chunks.push(e.data);
            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'audio/mp4' });
                results[currentQuestion].blob = blob;
                analyze(blob);
            };

            playTTS(q.instruction, () => {
                runTimer(q.prep, "Ready (ì¤€ë¹„)", () => {
                    chunks = []; mediaRecorder.start();
                    document.getElementById('recording-msg').style.display = 'block';
                    runTimer(q.resp, "Recording (ë…¹ìŒ ì¤‘)", () => {
                        mediaRecorder.stop();
                        document.getElementById('recording-msg').style.display = 'none';
                    });
                });
            });
        } else {
            document.getElementById('timer-label').innerText = "Listening (ë“£ëŠ” ì¤‘)...";
            document.getElementById('timer-display').innerText = "00:00";
            document.getElementById('progress-bar').style.width = "0%";
            
            playTTS(q.audioText, () => {
                runTimer(q.resp, "Choose Answer (ì •ë‹µ ì„ íƒ)", () => { scoreChoice(); });
            });
        }
    }

    function selectOption(idx) {
        selectedIdx = idx;
        document.querySelectorAll('.option-btn').forEach((b, i) => b.classList.toggle('selected', i === idx));
    }

    async function analyze(blob) {
        document.getElementById('loading-msg').style.display = 'block';
        const reader = new FileReader();
        reader.readAsDataURL(blob);
        reader.onloadend = async () => {
            const base64 = reader.result.split(',')[1];
            try {
                const teacherName = testData[testLang].teacher;
                const prompt = `ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ ${teacherName}ì…ë‹ˆë‹¤. ìˆ˜í—˜ìƒì˜ ìŒì„±ì„ ë°œìŒ, ì–µì–‘, ìœ ì°½ì„± ì¸¡ë©´ì—ì„œ í•œêµ­ì–´ë¡œ ì•„ì£¼ ìƒì„¸í•˜ê²Œ í‰ê°€í•˜ì„¸ìš”. ë§ˆì§€ë§‰ì— ë°˜ë“œì‹œ 'ì¢…í•© ì ìˆ˜: XXì ' í˜•ì‹ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.`;
                const res = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent?key=${USER_API_KEY}`, {
                    method: 'POST', body: JSON.stringify({ contents: [{ parts: [{ text: prompt }, { inline_data: { mime_type: "audio/mp4", data: base64 } }]}]})
                });
                const data = await res.json();
                const fb = data.candidates[0].content.parts[0].text;
                const scoreMatch = fb.match(/ì¢…í•© ì ìˆ˜:\s*(\d+)ì /);
                results[currentQuestion].score = scoreMatch ? parseInt(scoreMatch[1]) : 80;
                results[currentQuestion].fb = fb;
            } catch(e) { 
                results[currentQuestion].score = 0; 
                results[currentQuestion].fb = "í‰ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."; 
            }
            document.getElementById('loading-msg').style.display = 'none';
            next();
        };
    }

    function scoreChoice() {
        const q = testData[testLang].questions[3];
        const isCorrect = selectedIdx === q.answer;
        results[3].score = isCorrect ? 100 : 0;
        results[3].fb = isCorrect ? "ì •ë‹µì…ë‹ˆë‹¤! ì§ˆë¬¸ì„ ì •í™•íˆ ì´í•´í•˜ì…¨ë„¤ìš”." : `ì•„ì‰½ìŠµë‹ˆë‹¤. ì •ë‹µì€ ${q.answer + 1}ë²ˆì´ì—ˆìŠµë‹ˆë‹¤.`;
        next();
    }

    function next() {
        if(currentQuestion < 3) startQuestion(currentQuestion + 1);
        else showFinal();
    }

    function showFinal() {
        goToPage('page-summary');
        const container = document.getElementById('report-container');
        container.innerHTML = "";
        for(let i=1; i<=3; i++) {
            const card = document.createElement('div');
            card.className = 'report-card';
            card.innerHTML = `<div class="report-header"><b>ë¬¸í•­ ${i}</b><span>${results[i].score}ì </span></div>
                              <div style="font-size:0.9rem; line-height:1.6;">${results[i].fb.replace(/\n/g, '<br>')}</div>
                              ${i < 3 ? `<button style="margin-top:10px; font-size:11px;" onclick="downloadFile(${i})">ğŸ’¾ ìŒì› ì €ì¥</button>` : ''}`;
            container.appendChild(card);
        }
        document.getElementById('final-avg').innerText = ((results[1].score+results[2].score+results[3].score)/3).toFixed(1);
    }

    function downloadFile(n) {
        const b = results[n].blob;
        const a = document.createElement('a'); a.href = URL.createObjectURL(b);
        a.download = `${examineeID}_Q${n}.mp3`; a.click();
    }

    // [ëª¨ë°”ì¼ ëŒ€ì‘] êµ¬ê¸€ TTS ìµœì í™” í•¨ìˆ˜
    function playTTS(txt, cb) {
        // ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ë³´ì•ˆ ìš°íšŒë¥¼ ìœ„í•´ client=tw-ob íŒŒë¼ë¯¸í„° ê³ ì •
        const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(txt)}&tl=${testLang}&client=tw-ob`;
        
        ttsAudio.src = url;
        ttsAudio.playbackRate = 1.0;
        
        ttsAudio.onended = () => {
            ttsAudio.onended = null; // ì¤‘ë³µ ë°©ì§€
            if(cb) cb();
        };

        const playPromise = ttsAudio.play();
        if (playPromise !== undefined) {
            playPromise.catch(e => {
                console.warn("TTS Playback blocked:", e);
                if(cb) setTimeout(cb, 1000); // ì°¨ë‹¨ë  ê²½ìš° 1ì´ˆ ë’¤ ê°•ì œ ì§„í–‰
            });
        }
    }

    function runTimer(sec, lbl, cb) {
        let left = sec; 
        document.getElementById('timer-label').innerText = lbl;
        document.getElementById('timer-display').innerText = `00:${left < 10 ? '0'+left : left}`;
        document.getElementById('progress-bar').style.width = "0%";
        
        const timer = setInterval(() => {
            left--;
            document.getElementById('timer-display').innerText = `00:${left < 10 ? '0'+left : left}`;
            document.getElementById('progress-bar').style.width = `${((sec-left)/sec)*100}%`;
            if(left <= 0) { clearInterval(timer); cb(); }
        }, 1000);
    }

    function goToPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }
</script>
</body>
</html>
